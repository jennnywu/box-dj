/**************************************************************************************************/
/**
 * @file comm.h
 * @author Ryan Jing (r5jing@uwaterloo.ca)
 * @brief Communication module for I2C
 *
 * @version 0.1
 * @date 2025-11-07
 *
 * @copyright Copyright (c) 2025
 *
 */
/**************************************************************************************************/

#ifndef COMM_H
#define COMM_H

/*------------------------------------------------------------------------------------------------*/
// HEADERS                                                                                        */
/*------------------------------------------------------------------------------------------------*/

#include <stdio.h>

#include "driver/i2c.h"

/*------------------------------------------------------------------------------------------------*/
// GLOBAL VARIABLES                                                                               */
/*------------------------------------------------------------------------------------------------*/



/*------------------------------------------------------------------------------------------------*/
// CLASS DECLARATIONS                                                                             */
/*------------------------------------------------------------------------------------------------*/



/*------------------------------------------------------------------------------------------------*/
// MACROS                                                                                         */
/*------------------------------------------------------------------------------------------------*/

// I2C Configuration
#define I2C_SLAVE_SCL_IO        GPIO_NUM_32     // I2C SCL pin
#define I2C_SLAVE_SDA_IO        GPIO_NUM_33     // I2C SDA pin
#define I2C_SLAVE_NUM           I2C_NUM_0       // I2C port number
#define I2C_SLAVE_ADDR          0x42            // ESP32 I2C slave address
#define I2C_SLAVE_TX_BUF_LEN    128             // I2C slave tx buffer size
#define I2C_SLAVE_RX_BUF_LEN    128             // I2C slave rx buffer size

// I2C Data Packet Size
// Encoder1_Pos(4) + Encoder1_Vel(4) + Encoder2_Pos(4) + Encoder2_Vel(4) +
// Timestamp(4) + ButtonFlags(1) + VolumePot(2) + SliderPot(2) = 25 bytes
#define I2C_DATA_PACKET_SIZE    25

/*------------------------------------------------------------------------------------------------*/
// FUNCTION DECLARATIONS                                                                          */
/*------------------------------------------------------------------------------------------------*/

/**************************************************************************************************/
/**
 * @brief Initialize I2C slave communication
 * @return esp_err_t ESP_OK on success
 */
/**************************************************************************************************/
esp_err_t comm_init(void);

/**************************************************************************************************/
/**
 * @brief Update encoder data in I2C buffer (call periodically)
 * @return esp_err_t ESP_OK on success
 */
/**************************************************************************************************/
esp_err_t comm_update_encoder_data(void);

#endif // COMM_H